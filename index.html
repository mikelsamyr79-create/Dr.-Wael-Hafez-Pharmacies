<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل الدخول - صيدليات دكتور وائل حافظ</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Roboto',sans-serif;background:#111;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;transition:0.3s}
.login-card{background:#1a1a1a;padding:40px 30px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,0.7);width:100%;max-width:400px;text-align:center;border-top:4px solid #FFD700;transition:0.3s}
h2{color:#FFD700;margin-bottom:30px;font-size:28px}
input{width:100%;padding:14px 15px;margin:12px 0;border-radius:8px;border:1px solid #444;background:#222;color:#fff;font-size:16px;transition:0.3s}
input:focus{border-color:#FFD700;outline:none}
input::placeholder{color:#aaa}
button{width:100%;padding:15px;background:#FFD700;color:#000;font-weight:700;border:none;border-radius:8px;font-size:18px;cursor:pointer;transition:0.3s}
button:hover{background:#e6c200}
#errorMsg{color:#ff5252;margin-top:10px;font-weight:600;display:none}
#successMsg{color:#00ff9a;margin-top:10px;font-weight:600;display:none}
@media(max-width:500px){.login-card{padding:30px 20px}}
</style>
</head>
<body>

<div class="login-card">
<h2>تسجيل الدخول</h2>
<input type="text" id="userCode" placeholder="كود المستخدم">
<input type="password" id="password" placeholder="الرقم السري">
<button onclick="login()">دخول</button>
<div id="errorMsg">كود المستخدم أو الرقم السري غير صحيح</div>
<div id="successMsg">تم تسجيل الدخول بنجاح! جاري التوجيه...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

// تكوين Firebase
const firebaseConfig = {
  databaseURL: "https://hr-wael-hafez-default-rtdb.firebaseio.com/"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

async function login(){
  const code = document.getElementById('userCode').value.trim();
  const pass = document.getElementById('password').value.trim();
  const errorMsg = document.getElementById('errorMsg');
  const successMsg = document.getElementById('successMsg');
  errorMsg.style.display = 'none';
  successMsg.style.display = 'none';

  if(!code || !pass){
    errorMsg.innerText = 'الرجاء إدخال كود المستخدم والرقم السري';
    errorMsg.style.display = 'block';
    return;
  }

  try{
    const snapshot = await get(ref(db,'users'));
    if(snapshot.exists()){
      const users = snapshot.val();
      let found = false;

      for(let key in users){
        const user = users[key];
        if(user.code === code && String(user.password) === pass){
          found = true;
          localStorage.setItem('userRole', user.role);
          localStorage.setItem('userCode', user.code);

          successMsg.innerText = '✅ تم تسجيل الدخول بنجاح! جاري التوجيه...';
          successMsg.style.display = 'block';

          setTimeout(()=>{
            window.location.href = "dashboard.html"; // التوجيه للداشبورد الداخلي
          },1200);
          break;
        }
      }

      if(!found){
        errorMsg.innerText='كود المستخدم أو الرقم السري غير صحيح';
        errorMsg.style.display='block';
      }

    }else{
      errorMsg.innerText='لا يوجد مستخدمين في القاعدة';
      errorMsg.style.display='block';
    }
  }catch(err){
    console.error(err);
    errorMsg.innerText='حدث خطأ أثناء محاولة تسجيل الدخول';
    errorMsg.style.display='block';
  }
}
</script>

</body>
</html>
